<!DOCTYPE HTML>
<html>
<head lang="en">
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=3.0">
    <title>PHG JoyStick</title>
    <style>
        @media only screen and (orientation:portrait) {
            body {
                margin: 0px;
                padding: 0px;
                height: 100vw;
                transform: rotate(90deg);
            }
        }
        
        #joystick {
            border: 1px solid #9C9898;
        }
    </style>
    <script type="text/javascript">
    </script>
</head>

<body>
    <div style=" float:unset ">
        <input id='idbtHome' type='button' value='Go Home' onmousedown='fMoveHome()'>
        <input id='idbtSquare' type='button' value='Do square' onmousedown='fDoSquare(0)'>
        <input id='idbtStop' type='button' value='Stop' onmousedown='fStop()'>
        <input id='idbtContinue' type='button' value='Continue' onmousedown='fContinue()'>
    </div>

    <script type="text/javascript">
	//===============================================================		
        var Socket;
	//===============================================================		
        function Init1() {
//            Socket = new WebSocket('ws://' + window.location.hostname + ':81/');
            Socket = new WebSocket('ws://192.168.4.1:81/');
            Socket.onmessage = function(event) {
                var IstRobstr = event.data;
                console.log(event.data);
				try{
					var obj = JSON.parse(IstRobstr);
					if (obj.hasOwnProperty("inPos")) {;
					    if (obj.step != 0){fDoSquare(obj.step);}
					}
				} catch (e){
				}	
            }
        }
	//===============================================================		
        window.onload = Init1();
	//===============================================================		
		function fsendWebS(cmd){
				cmds= JSON.stringify(cmd);
				console.log(cmds);
       			Socket.send(cmds);
//				console.log("send: " + cmds);
		}
	//===============================================================	
        function fDoSquare(step1) {
		//  Get command from file
            var SetRob1 = {Newd: 1, Line: 1, Halt: 0, Mod: 2, Rx: 0, A5: 0, A6: 90, X:  100, Y: 200, Z: -100, Speed: 600 };
            var SetRob2 = {Newd: 1, Line: 2, Halt: 0, Mod: 2, Rx: 0, A5: 0, A6: 90, X:  100, Y: 200, Z: 100, Speed: 600 };
            var SetRob3 = {Newd: 1, Line: 3, Halt: 0, Mod: 2, Rx: 0, A5: 0, A6: 90, X: -100, Y: 200, Z: 100, Speed: 600 };
            var SetRob4 = {Newd: 1, Line: 4, Halt: 0, Mod: 2, Rx: 0, A5: 0, A6: 90, X: -100, Y: 200, Z: -100, Speed: 600 };
            var SetRob5 = {Newd: 1, Line: 0, Halt: 0, Mod: 2, Rx: 0, A5: 0, A6: 90, X:  100, Y: 200, Z: -100, Speed: 600 };
//			console.log(step1);
		//  send comand to robot
			if (step1 == 0 ){fsendWebS(SetRob1);}
			if (step1 == 1 ){fsendWebS(SetRob2);}
			if (step1 == 2 ){fsendWebS(SetRob3);}
			if (step1 == 3 ){fsendWebS(SetRob4);}
			if (step1 == 4 ){fsendWebS(SetRob5);}
			if (step1 == 5 ){fsendWebS(SetRob1);}
        }
	//===============================================================		
        function fMoveHome() {
            var SetRob = {Newd: 1, GoHome: 1, Halt: 0 };
			fsendWebS(SetRob);
        }
	//===============================================================		
        function fStop() {
            var SetRob = {Newd: 1, Halt: 1 };
			fsendWebS(SetRob);
        }
	//===============================================================		
        function fContinue() {
            var SetRob = {Newd: 1, Halt: 0 };
			fsendWebS(SetRob);
        }
	//===============================================================		
    </script>
</body>
</html> 